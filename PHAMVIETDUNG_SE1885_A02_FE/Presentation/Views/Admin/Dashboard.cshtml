@{
    ViewData["Title"] = "Executive Dashboard";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Dashboard</h2>
            <p class="text-muted mb-0">Real-time overview of system performance.</p>
        </div>
        <a href="@Url.Action("ExportReports", "Admin")" class="btn btn-success" data-requires-online="true">
            <i class="bi bi-file-earmark-excel"></i> Export Report
        </a>
    </div>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-warning border-0 shadow-sm rounded-3 mb-4">
            <i class="bi bi-exclamation-triangle me-2"></i> @ViewBag.Error
        </div>
    }

    <!-- Insight Cards (Generated via JS) -->
    <div class="row g-4 mb-4" id="stats-container">
        <!-- Loading Placeholders -->
         <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 placeholder-glow">
                <div class="card-body p-4"><span class="placeholder col-12"></span></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 placeholder-glow">
                <div class="card-body p-4"><span class="placeholder col-12"></span></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 placeholder-glow">
                <div class="card-body p-4"><span class="placeholder col-12"></span></div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0">Trending Categories</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-light rounded-circle" type="button"><i class="bi bi-three-dots"></i></button>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div style="height: 300px;">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pt-4 px-4 pb-0">
                    <h5 class="fw-bold mb-0">Article Status</h5>
                </div>
                <div class="card-body p-4 d-flex align-items-center justify-content-center">
                    <div style="height: 250px; width: 250px;">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0 pb-4 text-center">
                     <small class="text-muted">Distribution of active vs inactive content</small>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Global Chart Defaults
        Chart.defaults.font.family = "'Inter', system-ui, -apple-system, sans-serif";
        Chart.defaults.color = '#64748b';
        Chart.defaults.scale.grid.color = '#f1f5f9';
        
        const rawData = '@Html.Raw(ViewBag.DashboardStats)';
        if (!rawData) return;

        const data = JSON.parse(rawData);

        // Render Insight Cards
        const statsHtml = `
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 overflow-hidden">
                    <div class="card-body p-4 position-relative">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-primary-soft text-primary p-3 rounded-3 me-3">
                                <i class="bi bi-file-text fs-4"></i>
                            </div>
                            <div>
                                <p class="text-muted mb-0 small uppercase fw-bold tracking-wide">Total Articles</p>
                                <h3 class="fw-bold mb-0">${data.totalArticles}</h3>
                            </div>
                        </div>
                        <div class="d-flex align-items-center text-success small">
                            <i class="bi bi-arrow-up-right me-1"></i>
                            <span class="fw-semibold">12% increase</span>
                            <span class="text-muted ms-2">vs last month</span>
                        </div>
                    </div>
                </div>
            </div>
            
             <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 overflow-hidden">
                    <div class="card-body p-4 position-relative">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-success-soft text-success p-3 rounded-3 me-3">
                                <i class="bi bi-people fs-4"></i>
                            </div>
                            <div>
                                <p class="text-muted mb-0 small uppercase fw-bold tracking-wide">Active Authors</p>
                                <h3 class="fw-bold mb-0">${data.totalAuthors}</h3>
                            </div>
                        </div>
                         <div class="d-flex align-items-center text-success small">
                            <i class="bi bi-check-circle me-1"></i>
                            <span class="fw-semibold">Healthy</span>
                            <span class="text-muted ms-2">engagement</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 overflow-hidden">
                    <div class="card-body p-4 position-relative">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-warning-soft text-warning p-3 rounded-3 me-3">
                                <i class="bi bi-tags fs-4"></i>
                            </div>
                            <div>
                                <p class="text-muted mb-0 small uppercase fw-bold tracking-wide">Categories</p>
                                <h3 class="fw-bold mb-0">${data.totalCategories}</h3>
                            </div>
                        </div>
                         <div class="d-flex align-items-center text-muted small">
                            <i class="bi bi-dash me-1"></i>
                            <span class="fw-semibold">Stable</span>
                            <span class="text-muted ms-2">distribution</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('stats-container').innerHTML = statsHtml;

        // Render Status Chart (Doughnut - More Modern)
        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(data.statusBreakdown),
                datasets: [{
                    data: Object.values(data.statusBreakdown),
                    backgroundColor: ['#10b981', '#ef4444'], // Emerald, Red
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { usePointStyle: true, padding: 20 }
                    }
                },
                cutout: '75%'
            }
        });

        // Render Category Chart (Rounded Bar)
        if (data.topCategories && data.topCategories.length > 0) {
            const catCtx = document.getElementById('categoryChart').getContext('2d');
            new Chart(catCtx, {
                type: 'bar',
                data: {
                    labels: data.topCategories.map(c => c.category),
                    datasets: [{
                        label: 'Articles',
                        data: data.topCategories.map(c => c.count),
                        backgroundColor: '#3b82f6', // Blue 500
                        borderRadius: 6,
                        barThickness: 30
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { borderDash: [4, 4] }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
    });
</script>
    // Admin Dashboard does not seem to have SignalR connection logic in the viewed file.
    // It only renders charts from ViewBag data.
    // If there is no SignalR logic, no change needed.
    // Wait, let's look closer at the file content I viewed.
    // Lines 48-113: It parses ViewBag.DashboardStats and renders charts.
    // There is NO SignalR connection code in Admin/Dashboard.cshtml.
    // So I do not need to edit this file for variable collision.
