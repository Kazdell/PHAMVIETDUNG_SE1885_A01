@{
    ViewData["Title"] = "Advanced Search";
    var categories = ViewData["Categories"] as List<PHAMVIETDUNG_SE1885_A02_FE.Presentation.ViewModels.CategoryViewModel>;
    var tags = ViewData["Tags"] as List<PHAMVIETDUNG_SE1885_A02_FE.Presentation.ViewModels.TagViewModel>;
    var authors = ViewData["Authors"] as List<PHAMVIETDUNG_SE1885_A02_FE.Presentation.ViewModels.SystemAccountViewModel>;
}

<div class="container py-4">
    <div class="row">
        <!-- Sidebar Filters -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm border-0 sticky-top" style="top: 90px; z-index: 100;">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-sliders"></i> Filters</h5>
                </div>
                <div class="card-body">
                    <form id="searchForm" onsubmit="event.preventDefault(); runSearch();">
                        <div class="mb-3">
                            <label class="form-label fw-medium">Keyword</label>
                            <input type="text" id="keyword" class="form-control" placeholder="Search title, content...">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-medium">Category</label>
                            <select id="categoryId" class="form-select">
                                <option value="">All Categories</option>
                                @if(categories != null)
                                {
                                    foreach(var c in categories)
                                    {
                                        <option value="@c.CategoryId">@c.CategoryName</option>
                                    }
                                }
                            </select>
                        </div>

                         <div class="mb-3">
                            <label class="form-label fw-medium">Tag</label>
                            <select id="tagId" class="form-select">
                                <option value="">All Tags</option>
                                @if(tags != null)
                                {
                                    foreach(var t in tags)
                                    {
                                        <option value="@t.TagId">@t.TagName</option>
                                    }
                                }
                            </select>
                        </div>

                         <div class="mb-3">
                            <label class="form-label fw-medium">Author</label>
                            <select id="createdById" class="form-select">
                                <option value="">All Authors</option>
                                @if(authors != null)
                                {
                                    foreach(var a in authors) 
                                    {
                                        <option value="@a.AccountId">@a.AccountName</option>
                                    }
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-medium">Date Range</label>
                            <input type="date" id="minDate" class="form-control mb-2" placeholder="From">
                            <input type="date" id="maxDate" class="form-control" placeholder="To">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-medium">Sort By</label>
                            <select id="sort" class="form-select">
                                <option value="date_desc">Newest First</option>
                                <option value="date_asc">Oldest First</option>
                                <option value="title_asc">Title (A-Z)</option>
                                <option value="title_desc">Title (Z-A)</option>
                            </select>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Search</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetSearch()">Reset</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results Area -->
        <div class="col-lg-9">
            <div id="searchResults" class="min-vh-50">
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-search display-4 mb-3 d-block"></i>
                    Enter search criteria to find articles.
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function runSearch() {
            const data = {
                keyword: $('#keyword').val(),
                categoryId: $('#categoryId').val(),
                tagId: $('#tagId').val(),
                createdById: $('#createdById').val(),
                minDate: $('#minDate').val(),
                maxDate: $('#maxDate').val(),
                sort: $('#sort').val()
            };

            $('#searchResults').html('<div class="text-center py-5"><div class="spinner-border text-primary" role="status"></div></div>');

            $.get('@Url.Action("Results", "Search")', data, function(response) {
                $('#searchResults').html(response);
            }).fail(function() {
                $('#searchResults').html('<div class="alert alert-danger">Error loading results.</div>');
            });
        }

        function resetSearch() {
            $('#searchForm')[0].reset();
            $('#keyword').val(''); // Extra clear
            runSearch();
        }
    </script>
}
